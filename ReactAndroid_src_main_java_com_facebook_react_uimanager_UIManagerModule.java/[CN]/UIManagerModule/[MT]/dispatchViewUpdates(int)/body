{
  for (int i=0; i < mShadowNodeRegistry.getRootNodeCount(); i++) {
    int tag=mShadowNodeRegistry.getRootTag(i);
    ReactShadowNode cssRoot=mShadowNodeRegistry.getNode(tag);
    notifyOnBeforeLayoutRecursive(cssRoot);
    SystraceMessage.beginSection(Systrace.TRACE_TAG_REACT_JAVA_BRIDGE,"cssRoot.calculateLayout").arg("rootTag",tag).flush();
    try {
      cssRoot.calculateLayout(mLayoutContext);
    }
  finally {
      Systrace.endSection(Systrace.TRACE_TAG_REACT_JAVA_BRIDGE);
    }
    applyUpdatesRecursive(cssRoot,0f,0f);
  }
  mNativeViewHierarchyOptimizer.onBatchComplete();
  mOperationsQueue.dispatchViewUpdates(batchId);
}
