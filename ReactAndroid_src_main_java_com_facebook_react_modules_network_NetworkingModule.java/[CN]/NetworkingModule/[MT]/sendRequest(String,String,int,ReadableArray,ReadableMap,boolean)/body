{
  Request.Builder requestBuilder=new Request.Builder().url(url);
  if (requestId != 0) {
    requestBuilder.tag(requestId);
  }
  Headers requestHeaders=extractHeaders(headers,data);
  if (requestHeaders == null) {
    onRequestError(requestId,"Unrecognized headers format");
    return;
  }
  String contentType=requestHeaders.get(CONTENT_TYPE_HEADER_NAME);
  String contentEncoding=requestHeaders.get(CONTENT_ENCODING_HEADER_NAME);
  requestBuilder.headers(requestHeaders);
  if (data == null) {
    requestBuilder.method(method,null);
  }
 else   if (data.hasKey(REQUEST_BODY_KEY_STRING)) {
    if (contentType == null) {
      onRequestError(requestId,"Payload is set but no content-type header specified");
      return;
    }
    String body=data.getString(REQUEST_BODY_KEY_STRING);
    MediaType contentMediaType=MediaType.parse(contentType);
    if (RequestBodyUtil.isGzipEncoding(contentEncoding)) {
      RequestBody requestBody=RequestBodyUtil.createGzip(contentMediaType,body);
      if (requestBody == null) {
        onRequestError(requestId,"Failed to gzip request body");
        return;
      }
      requestBuilder.method(method,requestBody);
    }
 else {
      requestBuilder.method(method,RequestBody.create(contentMediaType,body));
    }
  }
 else   if (data.hasKey(REQUEST_BODY_KEY_URI)) {
    if (contentType == null) {
      onRequestError(requestId,"Payload is set but no content-type header specified");
      return;
    }
    String uri=data.getString(REQUEST_BODY_KEY_URI);
    InputStream fileInputStream=RequestBodyUtil.getFileInputStream(getReactApplicationContext(),uri);
    if (fileInputStream == null) {
      onRequestError(requestId,"Could not retrieve file for uri " + uri);
      return;
    }
    requestBuilder.method(method,RequestBodyUtil.create(MediaType.parse(contentType),fileInputStream));
  }
 else   if (data.hasKey(REQUEST_BODY_KEY_FORMDATA)) {
    if (contentType == null) {
      contentType="multipart/form-data";
    }
    ReadableArray parts=data.getArray(REQUEST_BODY_KEY_FORMDATA);
    MultipartBuilder multipartBuilder=constructMultipartBody(parts,contentType,requestId);
    if (multipartBuilder == null) {
      return;
    }
    requestBuilder.method(method,multipartBuilder.build());
  }
 else {
    requestBuilder.method(method,null);
  }
  mClient.newCall(requestBuilder.build()).enqueue(new Callback(){
    @Override public void onFailure(    Request request,    IOException e){
      if (mShuttingDown) {
        return;
      }
      onRequestError(requestId,e.getMessage());
    }
    @Override public void onResponse(    Response response) throws IOException {
      if (mShuttingDown) {
        return;
      }
      onResponseReceived(requestId,response);
      ResponseBody responseBody=response.body();
      try {
        if (useIncrementalUpdates) {
          readWithProgress(requestId,responseBody);
          onRequestSuccess(requestId);
        }
 else {
          onDataReceived(requestId,responseBody.string());
          onRequestSuccess(requestId);
        }
      }
 catch (      IOException e) {
        onRequestError(requestId,e.getMessage());
      }
    }
  }
);
}
