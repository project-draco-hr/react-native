{
  final SimpleSettableFuture<Looper> looperFuture=new SimpleSettableFuture<>();
  final SimpleSettableFuture<MessageQueueThread> mqtFuture=new SimpleSettableFuture<>();
  Thread bgThread=new Thread(new Runnable(){
    @Override public void run(){
      Looper.prepare();
      looperFuture.set(Looper.myLooper());
      MessageQueueThreadRegistry.register(mqtFuture.getOrThrow(5000,TimeUnit.MILLISECONDS));
      Looper.loop();
    }
  }
,"mqt_" + name);
  bgThread.start();
  Looper myLooper=looperFuture.getOrThrow(5000,TimeUnit.MILLISECONDS);
  MessageQueueThreadImpl mqt=new MessageQueueThreadImpl(name,myLooper,exceptionHandler);
  mqtFuture.set(mqt);
  return mqt;
}
