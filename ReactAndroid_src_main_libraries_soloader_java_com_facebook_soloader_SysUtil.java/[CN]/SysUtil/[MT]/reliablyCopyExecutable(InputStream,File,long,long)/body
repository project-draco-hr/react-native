{
  destination.delete();
  try (FileOutputStream os=new FileOutputStream(destination)){
    byte buffer[];
    if (cachedBuffer == null) {
      cachedBuffer=buffer=new byte[16384];
    }
 else {
      buffer=cachedBuffer;
    }
    int nrBytes;
    if (expectedSize > 0) {
      fallocateIfSupported(os.getFD(),expectedSize);
    }
    while ((nrBytes=is.read(buffer,0,buffer.length)) >= 0) {
      os.write(buffer,0,nrBytes);
    }
    os.getFD().sync();
    destination.setExecutable(true);
    destination.setLastModified(time);
    os.getFD().sync();
  }
 }
