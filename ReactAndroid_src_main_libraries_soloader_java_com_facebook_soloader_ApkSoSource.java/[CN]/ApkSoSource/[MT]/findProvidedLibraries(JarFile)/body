{
  Pattern libPattern=Pattern.compile("^lib/([^/]+)/([^/]+\\.so)$");
  HashMap<String,SoInfo> providedLibraries=new HashMap<>();
  String[] supportedAbis=SysUtil.getSupportedAbis();
  Enumeration<JarEntry> entries=apk.entries();
  while (entries.hasMoreElements()) {
    JarEntry entry=entries.nextElement();
    Matcher m=libPattern.matcher(entry.getName());
    if (m.matches()) {
      String libraryAbi=m.group(1);
      String soName=m.group(2);
      int abiScore=SysUtil.findAbiScore(supportedAbis,libraryAbi);
      if (abiScore >= 0) {
        SoInfo so=providedLibraries.get(soName);
        if (so == null || abiScore < so.abiScore) {
          providedLibraries.put(soName,new SoInfo(soName,entry,abiScore));
        }
      }
    }
  }
  return providedLibraries;
}
